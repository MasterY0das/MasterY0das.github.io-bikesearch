<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BikeMatch - Find Your Perfect Ride</title>
    <style>
        :root {
            --primary: #FF9900;
            --primary-dark: #E68A00;
            --secondary: #232F3E;
            --accent: #48A3FF;
            --dark: #131921;
            --light: #f8f8f8;
            --success: #39B54A;
            --warning: #FFD814;
            --danger: #CC0C39;
            --gray-light: #eaeded;
            --gray: #DDD;
            --text-dark: #0F1111;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Arial', 'Helvetica Neue', sans-serif;
        }
        
        body {
            background-color: var(--light);
            color: var(--text-dark);
            line-height: 1.6;
            background-image: url('https://images.unsplash.com/photo-1541625602330-2277a4c46182?ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80');
            background-size: cover;
            background-attachment: fixed;
            background-position: center;
            background-repeat: no-repeat;
            background-blend-mode: overlay;
            background-color: rgba(255, 255, 255, 0.9);
        }
        
        header {
            background: var(--dark);
            color: white;
            padding: 1.2rem 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            background-image: linear-gradient(to right, var(--dark), #1a3a5f);
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url('https://images.unsplash.com/photo-1507035895480-2b3156c31fc8?ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80');
            background-size: cover;
            background-position: center;
            opacity: 0.2;
            z-index: 0;
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
            display: flex;
            flex-direction: column;
            position: relative;
            z-index: 1;
        }
        
        h1 {
            margin-bottom: 0.3rem;
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--primary);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        
        .subtitle {
            font-weight: 300;
            opacity: 0.9;
            font-size: 1rem;
            color: #fff;
        }
        
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }
        
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid #E3E3E3;
            position: relative;
            overflow: hidden;
        }
        
        .card::after {
            content: '';
            position: absolute;
            bottom: 0;
            right: 0;
            width: 150px;
            height: 150px;
            background-image: url('https://cdn-icons-png.flaticon.com/512/2972/2972185.png');
            background-size: contain;
            background-repeat: no-repeat;
            opacity: 0.05;
            z-index: 0;
        }
        
        .form-group {
            margin-bottom: 1.2rem;
            position: relative;
            z-index: 1;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--secondary);
        }
        
        select, input {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid var(--gray);
            border-radius: 4px;
            font-size: 0.95rem;
            transition: all 0.3s;
            background-color: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05) inset;
        }
        
        select:focus, input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(255, 153, 0, 0.2);
            outline: none;
        }
        
        .slider-container {
            margin-top: 0.5rem;
            position: relative;
            padding: 0.5rem 0;
        }
        
        .slider {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 5px;  
            background: var(--gray-light);
            outline: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 22px;
            height: 22px;
            border-radius: 50%; 
            background: var(--primary);
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: transform 0.2s;
        }
        
        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.15);
        }
        
        .slider::-moz-range-thumb {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: transform 0.2s;
            border: none;
        }
        
        .slider::-moz-range-thumb:hover {
            transform: scale(1.15);
        }
        
        .slider-value {
            text-align: center;
            font-weight: 600;
            margin-top: 0.5rem;
            color: var(--primary);
            font-size: 1.2rem;
        }
        
        .btn {
            background: linear-gradient(to bottom, var(--warning), #e6c200);
            color: var(--text-dark);
            border: 1px solid #c7a61a;
            padding: 0.9rem 1.8rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: block;
            margin: 1.8rem auto 0.5rem;
            min-width: 220px;
            position: relative;
            overflow: hidden;
        }
        
        .btn:hover {
            background: linear-gradient(to bottom, #ffce29, #e6c200);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .btn:active {
            transform: translateY(1px);
            box-shadow: 0 2px 3px rgba(0,0,0,0.1);
        }
        
        .btn:disabled {
            background-color: var(--gray);
            cursor: not-allowed;
            box-shadow: none;
        }
        
        .bike-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }
        
        .bike-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: all 0.3s;
            cursor: pointer;
            border: 1px solid #E3E3E3;
            position: relative;
        }
        
        .bike-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.15);
        }
        
        .bike-image {
            height: 220px;
            background-color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            border-bottom: 1px solid var(--gray-light);
            position: relative;
            overflow: hidden;
        }
        
        .bike-image::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 40px;
            background: linear-gradient(to top, rgba(255,255,255,0.8), transparent);
            z-index: 1;
        }
        
        .bike-image img {
            max-width: 100%;
            max-height: 180px;
            object-fit: contain;
            transition: transform 0.3s;
        }
        
        .bike-card:hover .bike-image img {
            transform: scale(1.05);
        }
        
        .bike-details {
            padding: 1.2rem;
            background: linear-gradient(to bottom, white, #f9f9f9);
        }
        
        .bike-name {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.3rem;
            color: var(--text-dark);
        }
        
        .bike-year {
            color: var(--accent);
            font-weight: 600;
            margin-bottom: 0.3rem;
            font-size: 0.9rem;
        }
        
        .bike-manufacturer {
            color: #717171;
            margin-bottom: 1rem;
            font-size: 0.95rem;
        }
        
        .bike-spec {
            display: flex;
            justify-content: space-between;
            border-top: 1px solid var(--gray-light);
            padding-top: 1rem;
            margin-top: 0.5rem;
        }
        
        .bike-spec span {
            display: block;
        }
        
        .spec-label {
            font-size: 0.75rem;
            color: #717171;
        }
        
        .spec-value {
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .match-score {
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(to bottom, var(--success), #2d9e3e);
            color: white;
            padding: 0.4rem 0.7rem;
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.8rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.15);
            z-index: 2;
        }
        
        .free-shipping {
            position: absolute;
            top: 10px;
            left: 10px;
            background: linear-gradient(to bottom, var(--primary), var(--primary-dark));
            color: white;
            padding: 0.3rem 0.6rem;
            border-radius: 3px;
            font-weight: 600;
            font-size: 0.75rem;
            z-index: 2;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .loading {
            text-align: center;
            margin: 3rem 0;
            padding: 2rem;
            background: rgba(255,255,255,0.9);
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border-left-color: var(--primary);
            animation: spin 1s linear infinite;
            margin: 0 auto 1.5rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .preferences-summary {
            background: linear-gradient(to right, #fff, #f8f8f8);
            border-left: 4px solid var(--primary);
            padding: 1.2rem 1.5rem;
            margin-bottom: 2rem;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
        }
        
        .preferences-summary h3 {
            color: var(--secondary);
            margin-bottom: 0.8rem;
            font-size: 1.1rem;
            position: relative;
            padding-bottom: 0.5rem;
        }
        
        .preferences-summary h3::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 40px;
            height: 2px;
            background-color: var(--primary);
        }
        
        .preferences-summary ul {
            list-style-type: none;
            display: flex;
            flex-wrap: wrap;
            gap: 0.8rem;
        }
        
        .preferences-summary li {
            background-color: white;
            padding: 0.5rem 0.9rem;
            border-radius: 5px;
            font-size: 0.9rem;
            border: 1px solid #ddd;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            transition: all 0.2s;
        }
        
        .preferences-summary li:hover {
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        
        .error {
            color: var(--danger);
            margin-top: 0.5rem;
            font-weight: 500;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            overflow-y: auto;
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 2rem;
            border-radius: 8px;
            max-width: 850px;
            position: relative;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            animation: modalFadeIn 0.3s;
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .close-modal {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 2rem;
            cursor: pointer;
            color: #aaa;
            transition: color 0.2s;
            z-index: 10;
        }
        
        .close-modal:hover {
            color: var(--text-dark);
        }
        
        .section-title {
            color: var(--secondary);
            margin: 1.8rem 0 0.8rem;
            font-size: 1.3rem;
            position: relative;
            padding-bottom: 0.6rem;
        }
        
        .section-title:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 50px;
            height: 3px;
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
            border-radius: 2px;
        }
        
        .similar-bikes {
            display: flex;
            overflow-x: auto;
            gap: 1.2rem;
            padding: 1.2rem 0;
            scrollbar-width: thin;
            scrollbar-color: var(--primary) var(--gray-light);
        }
        
        .similar-bikes::-webkit-scrollbar {
            height: 8px;
        }
        
        .similar-bikes::-webkit-scrollbar-track {
            background: var(--gray-light);
            border-radius: 10px;
        }
        
        .similar-bikes::-webkit-scrollbar-thumb {
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
            border-radius: 10px;
        }
        
        .similar-bike-card {
            min-width: 220px;
            background: white;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
            border: 1px solid var(--gray-light);
            transition: all 0.3s;
        }
        
        .similar-bike-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 12px rgba(0,0,0,0.15);
        }
        
        .toggle-container {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 35px;
            vertical-align: middle;
            margin-left: 10px;
        }
        
        .toggle-checkbox {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-label {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 30px;
        }
        
        .toggle-label:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        
        .toggle-checkbox:checked + .toggle-label {
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
        }
        
        .toggle-checkbox:checked + .toggle-label:before {
            transform: translateX(30px);
        }
        
        .price-tag {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--danger);
            margin: 0.7rem 0;
            display: inline-block;
            position: relative;
        }
        
        .price-tag::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            width: 100%;
            height: 1px;
            background: linear-gradient(to right, var(--danger), transparent);
        }
        
        .rating {
            color: var(--primary);
            font-size: 0.9rem;
            margin-bottom: 0.7rem;
            display: flex;
            align-items: center;
        }
        
        .rating::before {
            content: '';
            display: inline-block;
            width: 16px;
            height: 16px;
            background-image: url('https://cdn-icons-png.flaticon.com/512/1828/1828884.png');
            background-size: contain;
            margin-right: 5px;
            opacity: 0.9;
        }
        
        .filters-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid var(--gray-light);
            padding-bottom: 1rem;
            position: relative;
        }
        
        .filters-header::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 80px;
            height: 2px;
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
        }
        
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid var(--gray-light);
            padding-bottom: 1rem;
            position: relative;
        }
        
        .results-header::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 80px;
            height: 2px;
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
        }
        
        .sort-select {
            width: auto;
            padding: 0.5rem 2rem 0.5rem 0.8rem;
            margin-left: 0.5rem;
            font-size: 0.9rem;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            appearance: none;
            background-image: url('https://cdn-icons-png.flaticon.com/512/32/32195.png');
            background-repeat: no-repeat;
            background-position: right 8px center;
            background-size: 12px;
        }
        
        .radio-group {
            display: flex;
            gap: 1.2rem;
            margin-top: 0.7rem;
            flex-wrap: wrap;
        }
        
        .radio-option {
            display: flex;
            align-items: center;
            position: relative;
            padding-left: 30px;
            cursor: pointer;
        }
        
        .radio-option input[type="radio"] {
            position: absolute;
            opacity: 0;
            cursor: pointer;
            height: 0;
            width: 0;
        }
        
        .radio-option label {
            display: inline;
            margin: 0;
            font-weight: normal;
            cursor: pointer;
            transition: color 0.2s;
        }
        
        .radio-option:hover label {
            color: var(--primary);
        }
        
        .radio-option::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            border: 2px solid #ddd;
            border-radius: 50%;
            transition: all 0.2s;
        }
        
        .radio-option:hover::before {
            border-color: var(--primary);
        }
        
        .radio-option input:checked ~ label {
            color: var(--primary);
            font-weight: 500;
        }
        
        .radio-option input:checked ~ ::before {
            border-color: var(--primary);
            border-width: 2px;
        }
        
        .radio-option::after {
            content: '';
            position: absolute;
            left: 5px;
            top: 50%;
            transform: translateY(-50%);
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--primary);
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .radio-option input:checked ~ ::after {
            opacity: 1;
        }
        
        @media (max-width: 768px) {
            .bike-list {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 0 1rem;
            }
            
            .modal-content {
                width: 95%;
                margin: 5% auto;
                padding: 1.5rem;
            }
            
            .preferences-summary ul {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .results-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.8rem;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <h1>BikeMatch</h1>
            <p class="subtitle">Find your perfect ride with personalized recommendations</p>
        </div>
    </header>
    
    <div class="container">
        <div class="card">
            <div class="filters-header">
                <h2>Tell us your preferences</h2>
                <p>We'll find the perfect match for you</p>
            </div>
            
            <form id="preferences-form">
                <div class="form-group">
                    <label for="manufacturer">Preferred Manufacturer</label>
                    <select id="manufacturer">
                        <option value="">Any manufacturer</option>
                        <!-- Will be populated by JavaScript -->
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="year-slider">Year: <span id="year-value">2023</span></label>
                    <div class="slider-container">
                        <input type="range" min="2000" max="2025" value="2023" class="slider" id="year-slider">
                    </div>
                    <div style="display: flex; align-items: center; margin-top: 0.5rem;">
                        <label for="any-year" style="display: inline; margin-right: 0.5rem;">Any year</label>
                        <div class="toggle-container">
                            <input type="checkbox" id="any-year" class="toggle-checkbox" checked>
                            <label for="any-year" class="toggle-label"></label>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="bike-type">Bike Type</label>
                    <select id="bike-type">
                        <option value="">Any type</option>
                        <option value="road">Road</option>
                        <option value="mountain">Mountain</option>
                        <option value="hybrid">Hybrid</option>
                        <option value="commuter">Commuter</option>
                        <option value="touring">Touring</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="price-range">Price Range</label>
                    <select id="price-range">
                        <option value="">Any price</option>
                        <option value="budget">Budget (Under $500)</option>
                        <option value="mid">Mid-range ($500-$1000)</option>
                        <option value="premium">Premium ($1000-$2000)</option>
                        <option value="high-end">High-end ($2000+)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Gender Preference</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="gender-male" name="gender" value="male">
                            <label for="gender-male">Male</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="gender-female" name="gender" value="female">
                            <label for="gender-female">Female</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="gender-any" name="gender" value="" checked>
                            <label for="gender-any">No Preference</label>
                        </div>
                    </div>
                </div>
                
                <button type="submit" class="btn" id="find-bikes-btn">Find My Perfect Bike</button>
            </form>
        </div>
        
        <div id="results-section" style="display: none;">
            <div class="preferences-summary" id="preferences-summary">
                <!-- Will be populated by JavaScript -->
            </div>
            
            <div class="results-header">
                <h2>Recommended Bikes For You</h2>
                <div>
                    <label for="sort-by" style="display: inline;">Sort by:</label>
                    <select id="sort-by" class="sort-select">
                        <option value="match">Best Match</option>
                        <option value="price-low">Price: Low to High</option>
                        <option value="price-high">Price: High to Low</option>
                        <option value="year">Newest First</option>
                    </select>
                </div>
            </div>
            
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Finding your perfect bikes...</p>
            </div>
            
            <div class="bike-list" id="bike-list">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>
    </div>
    
    <div class="modal" id="bike-modal">
        <div class="modal-content">
            <span class="close-modal" id="close-modal">&times;</span>
            <div id="modal-content">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>
    </div>
    
    <script>
        // Global variables
        let manufacturers = [];
        let recommendedBikes = [];
        let userPreferences = {};
        
        // Constants
        const BIKEBOOK_API = 'https://bikebook.io';
        const BIKE_IMAGES = {
            'road': 'https://images.unsplash.com/photo-1485965120184-e220f721d03e?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80',
            'mountain': 'https://images.unsplash.com/photo-1544191696-102dbdaeeaa0?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80',
            'hybrid': 'https://images.unsplash.com/photo-1507035895480-2b3156c31fc8?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80',
            'commuter': 'https://images.unsplash.com/photo-1529422643029-d4585747aaf2?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80',
            'touring': 'https://images.unsplash.com/photo-1571333250630-f0230c320b6d?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80',
            'default': 'https://images.unsplash.com/photo-1511994298241-608e28f14fde?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80'
        };
        
        // Prices for mock data
        const PRICE_RANGES = {
            'budget': { min: 299, max: 499 },
            'mid': { min: 500, max: 999 },
            'premium': { min: 1000, max: 1999 },
            'high-end': { min: 2000, max: 5000 }
        };
        
        // DOM Elements
        const manufacturerSelect = document.getElementById('manufacturer');
        const yearSlider = document.getElementById('year-slider');
        const yearValue = document.getElementById('year-value');
        const anyYearCheckbox = document.getElementById('any-year');
        const bikeTypeSelect = document.getElementById('bike-type');
        const priceRangeSelect = document.getElementById('price-range');
        const preferencesForm = document.getElementById('preferences-form');
        const findBikesBtn = document.getElementById('find-bikes-btn');
        const resultsSection = document.getElementById('results-section');
        const preferencesSummary = document.getElementById('preferences-summary');
        const bikeList = document.getElementById('bike-list');
        const loadingElement = document.getElementById('loading');
        const bikeModal = document.getElementById('bike-modal');
        const closeModal = document.getElementById('close-modal');
        const modalContent = document.getElementById('modal-content');
        const sortBySelect = document.getElementById('sort-by');
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', initialize);
        
        function initialize() {
            // Add event listeners
            preferencesForm.addEventListener('submit', handleFormSubmit);
            closeModal.addEventListener('click', () => bikeModal.style.display = 'none');
            window.addEventListener('click', (e) => {
                if (e.target === bikeModal) {
                    bikeModal.style.display = 'none';
                }
            });
            
            // Year slider functionality
            yearSlider.addEventListener('input', function() {
                yearValue.textContent = this.value;
                // Uncheck "Any year" when slider is moved
                anyYearCheckbox.checked = false;
            });
            
            // Any year checkbox functionality
            anyYearCheckbox.addEventListener('change', function() {
                yearSlider.disabled = this.checked;
                yearSlider.style.opacity = this.checked ? "0.5" : "1";
            });
            
            // Sort by select functionality
            sortBySelect.addEventListener('change', sortBikes);
            
            // Set initial slider state
            yearSlider.disabled = anyYearCheckbox.checked;
            yearSlider.style.opacity = anyYearCheckbox.checked ? "0.5" : "1";
            
            // Fetch manufacturers and populate select
            fetchManufacturers();
        }
        
        // Fetch all manufacturers from the API
        async function fetchManufacturers() {
            try {
                const response = await fetch(`${BIKEBOOK_API}/assets/index.json`);
                if (!response.ok) {
                    throw new Error('Failed to fetch manufacturers');
                }
                
                const data = await response.json();
                manufacturers = Object.keys(data).sort();
                
                // Populate the manufacturer dropdown
                manufacturers.forEach(manufacturer => {
                    const option = document.createElement('option');
                    option.value = manufacturer;
                    option.textContent = manufacturer;
                    manufacturerSelect.appendChild(option);
                });
            } catch (error) {
                console.error('Error fetching manufacturers:', error);
                // Use mock data if API fails
                const mockManufacturers = ['Trek', 'Specialized', 'Giant', 'Cannondale', 'Fuji', 'Bianchi', 'Cervelo', 'Scott', 'Santa Cruz', 'Surly'];
                mockManufacturers.forEach(manufacturer => {
                    const option = document.createElement('option');
                    option.value = manufacturer;
                    option.textContent = manufacturer;
                    manufacturerSelect.appendChild(option);
                });
            }
        }
        
        // Handle form submission
        function handleFormSubmit(e) {
            e.preventDefault();
            
            // Get user preferences
            userPreferences = {
                manufacturer: manufacturerSelect.value,
                year: anyYearCheckbox.checked ? "" : yearSlider.value,
                bikeType: bikeTypeSelect.value,
                priceRange: priceRangeSelect.value,
                gender: document.querySelector('input[name="gender"]:checked').value
            };
            
            // Reset recommended bikes
            recommendedBikes = [];
            
            // Show results section and loading spinner
            resultsSection.style.display = 'block';
            loadingElement.style.display = 'block';
            bikeList.innerHTML = '';
            
            // Display preferences summary
            updatePreferencesSummary();
            
            // Get bike recommendations
            getBikeRecommendations();
            
            // Scroll to results
            setTimeout(() => {
                resultsSection.scrollIntoView({ behavior: 'smooth' });
            }, 100);
        }
        
        // Update the preferences summary section
        function updatePreferencesSummary() {
            let summaryHTML = '<h3>Your Preferences</h3><ul>';
            
            if (userPreferences.manufacturer) {
                summaryHTML += `<li><strong>Brand:</strong> ${userPreferences.manufacturer}</li>`;
            } else {
                summaryHTML += `<li><strong>Brand:</strong> Any</li>`;
            }
            
            if (userPreferences.year) {
                summaryHTML += `<li><strong>Year:</strong> ${userPreferences.year}</li>`;
            } else {
                summaryHTML += `<li><strong>Year:</strong> Any</li>`;
            }
            
            if (userPreferences.bikeType) {
                const bikeTypeText = bikeTypeSelect.options[bikeTypeSelect.selectedIndex].text;
                summaryHTML += `<li><strong>Type:</strong> ${bikeTypeText}</li>`;
            } else {
                summaryHTML += `<li><strong>Type:</strong> Any</li>`;
            }
            
            if (userPreferences.priceRange) {
                const priceRangeText = priceRangeSelect.options[priceRangeSelect.selectedIndex].text;
                summaryHTML += `<li><strong>Price:</strong> ${priceRangeText}</li>`;
            } else {
                summaryHTML += `<li><strong>Price:</strong> Any</li>`;
            }
            
            if (userPreferences.gender) {
                summaryHTML += `<li><strong>Gender:</strong> ${userPreferences.gender.charAt(0).toUpperCase() + userPreferences.gender.slice(1)}</li>`;
            } else {
                summaryHTML += `<li><strong>Gender:</strong> No Preference</li>`;
            }
            
            summaryHTML += '</ul>';
            preferencesSummary.innerHTML = summaryHTML;
        }
        
        // Get bike recommendations based on user preferences
        async function getBikeRecommendations() {
            try {
                // If manufacturer is selected, get models for that manufacturer
                if (userPreferences.manufacturer) {
                    let url = `${BIKEBOOK_API}/model_list?manufacturer=${encodeURIComponent(userPreferences.manufacturer)}`;
                    
                    const response = await fetch(url);
                    if (!response.ok) {
                        throw new Error('Failed to fetch bike models');
                    }
                    
                    const models = await response.json();
                    
                    // Get detailed information for each model
                    // Process models and create recommendations
                    for (const model of models.slice(0, 20)) { // Limit to 20 models for performance
                        try {
                            const modelUrl = `${BIKEBOOK_API}/model_detail?manufacturer=${encodeURIComponent(userPreferences.manufacturer)}&model=${encodeURIComponent(model)}`;
                            const modelResponse = await fetch(modelUrl);
                            
                            if (!modelResponse.ok) {
                                continue;
                            }
                            
                            const modelData = await modelResponse.json();
                            
                            // Filter by year if specified
                            if (userPreferences.year && modelData.year !== parseInt(userPreferences.year)) {
                                continue;
                            }
                            
                            // Create bike object
                            const bike = {
                                id: Math.random().toString(36).substr(2, 9),
                                name: model,
                                manufacturer: userPreferences.manufacturer,
                                year: modelData.year || 2023,
                                type: modelData.type || getRandomBikeType(),
                                price: getRandomPrice(userPreferences.priceRange),
                                specs: {
                                    weight: Math.floor(Math.random() * 10) + 5 + " kg",
                                    material: getRandomMaterial(),
                                    gears: Math.floor(Math.random() * 24) + 1
                                },
                                matchScore: calculateMatchScore(modelData),
                                image: getBikeImage(modelData.type),
                                gender: modelData.gender || getRandomGender(),
                                freeShipping: Math.random() > 0.5
                            };
                            
                            // Filter by bike type if specified
                            if (userPreferences.bikeType && bike.type !== userPreferences.bikeType) {
                                continue;
                            }
                            
                            // Filter by gender if specified
                            if (userPreferences.gender && bike.gender !== userPreferences.gender && bike.gender !== 'unisex') {
                                continue;
                            }
                            
                            recommendedBikes.push(bike);
                        } catch (error) {
                            console.error(`Error processing model ${model}:`, error);
                        }
                    }
                } else {
                    // If no manufacturer selected, generate random recommendations
                    generateRandomRecommendations();
                }
                
                // If no bikes found, generate random recommendations
                if (recommendedBikes.length === 0) {
                    generateRandomRecommendations();
                }
                
                // Sort bikes by match score
                sortBikes();
                
                // Hide loading spinner and display bikes
                loadingElement.style.display = 'none';
                displayBikes();
                
            } catch (error) {
                console.error('Error getting bike recommendations:', error);
                // Generate random recommendations if API fails
                generateRandomRecommendations();
                sortBikes();
                loadingElement.style.display = 'none';
                displayBikes();
            }
        }
        
        // Generate random bike recommendations
        function generateRandomRecommendations() {
            const mockManufacturers = [
                'Trek', 'Specialized', 'Giant', 'Cannondale', 'Scott', 
                'Santa Cruz', 'Cervélo', 'Bianchi', 'Kona', 'Orbea',
                'Pinarello', 'BMC', 'Felt', 'GT', 'Marin'
            ];
            
            const mockModels = [
                'Domane', 'Emonda', 'Madone', 'Checkpoint', 'Fuel EX',
                'Tarmac', 'Roubaix', 'Diverge', 'Epic', 'Stumpjumper',
                'Defy', 'TCR', 'Propel', 'Revolt', 'Anthem',
                'SuperSix', 'Synapse', 'CAAD', 'Topstone', 'Scalpel',
                'Addict', 'Spark', 'Scale', 'Genius', 'Contessa'
            ];
            
            // Generate 15 random bikes
            for (let i = 0; i < 15; i++) {
                const manufacturer = userPreferences.manufacturer || mockManufacturers[Math.floor(Math.random() * mockManufacturers.length)];
                const bikeType = userPreferences.bikeType || getRandomBikeType();
                const year = userPreferences.year || Math.floor(Math.random() * 10) + 2015;
                const gender = userPreferences.gender || getRandomGender();
                
                const bike = {
                    id: Math.random().toString(36).substr(2, 9),
                    name: mockModels[Math.floor(Math.random() * mockModels.length)],
                    manufacturer: manufacturer,
                    year: parseInt(year),
                    type: bikeType,
                    price: getRandomPrice(userPreferences.priceRange),
                    specs: {
                        weight: Math.floor(Math.random() * 10) + 5 + " kg",
                        material: getRandomMaterial(),
                        gears: Math.floor(Math.random() * 24) + 1
                    },
                    matchScore: Math.floor(Math.random() * 30) + 70,
                    image: getBikeImage(bikeType),
                    gender: gender,
                    freeShipping: Math.random() > 0.5
                };
                
                recommendedBikes.push(bike);
            }
        }
        
        // Calculate match score based on user preferences
        function calculateMatchScore(bikeData) {
            let score = 70; // Base score
            
            // Add points for matching preferences
            if (userPreferences.bikeType && bikeData.type === userPreferences.bikeType) {
                score += 10;
            }
            
            if (userPreferences.year && bikeData.year === parseInt(userPreferences.year)) {
                score += 10;
            }
            
            if (userPreferences.gender && (bikeData.gender === userPreferences.gender || bikeData.gender === 'unisex')) {
                score += 10;
            }
            
            // Add some randomness
            score += Math.floor(Math.random() * 10);
            
            // Cap at 100
            return Math.min(score, 100);
        }
        
        // Get random bike type
        function getRandomBikeType() {
            const types = ['road', 'mountain', 'hybrid', 'commuter', 'touring'];
            return types[Math.floor(Math.random() * types.length)];
        }
        
        // Get random gender
        function getRandomGender() {
            const genders = ['male', 'female', 'unisex'];
            return genders[Math.floor(Math.random() * genders.length)];
        }
        
        // Get random frame material
        function getRandomMaterial() {
            const materials = ['Carbon', 'Aluminum', 'Steel', 'Titanium'];
            return materials[Math.floor(Math.random() * materials.length)];
        }
        
        // Get random price based on price range
        function getRandomPrice(priceRange) {
            if (priceRange && PRICE_RANGES[priceRange]) {
                const range = PRICE_RANGES[priceRange];
                return Math.floor(Math.random() * (range.max - range.min + 1)) + range.min;
            }
            
            // Default price range if none specified
            return Math.floor(Math.random() * 3000) + 300;
        }
        
        // Get bike image based on type
        function getBikeImage(type) {
            if (type && BIKE_IMAGES[type]) {
                return BIKE_IMAGES[type];
            }
            return BIKE_IMAGES.default;
        }
        
        // Display bikes in the bike list
        function displayBikes() {
            bikeList.innerHTML = '';
            
            if (recommendedBikes.length === 0) {
                bikeList.innerHTML = '<p>No bikes found matching your criteria. Please try different preferences.</p>';
                return;
            }
            
            recommendedBikes.forEach(bike => {
                const bikeCard = document.createElement('div');
                bikeCard.className = 'bike-card';
                bikeCard.dataset.bikeId = bike.id;
                
                bikeCard.innerHTML = `
                    <div class="bike-image">
                        <img src="${bike.image}" alt="${bike.manufacturer} ${bike.name}">
                        <div class="match-score">${bike.matchScore}% Match</div>
                        ${bike.freeShipping ? '<div class="free-shipping">Free Shipping</div>' : ''}
                    </div>
                    <div class="bike-details">
                        <div class="bike-year">${bike.year}</div>
                        <div class="bike-name">${bike.name}</div>
                        <div class="bike-manufacturer">${bike.manufacturer}</div>
                        <div class="price-tag">$${bike.price.toLocaleString()}</div>
                        <div class="rating">★★★★☆ (${Math.floor(Math.random() * 100) + 10})</div>
                        <div class="bike-spec">
                            <div>
                                <span class="spec-label">Weight</span>
                                <span class="spec-value">${bike.specs.weight}</span>
                            </div>
                            <div>
                                <span class="spec-label">Material</span>
                                <span class="spec-value">${bike.specs.material}</span>
                            </div>
                            <div>
                                <span class="spec-label">Gears</span>
                                <span class="spec-value">${bike.specs.gears}</span>
                            </div>
                        </div>
                    </div>
                `;
                
                bikeCard.addEventListener('click', () => showBikeDetails(bike));
                bikeList.appendChild(bikeCard);
            });
        }
        
        // Show bike details in modal
        function showBikeDetails(bike) {
            modalContent.innerHTML = `
                <h2>${bike.year} ${bike.manufacturer} ${bike.name}</h2>
                <div class="price-tag">$${bike.price.toLocaleString()}</div>
                <div class="rating">★★★★☆ (${Math.floor(Math.random() * 100) + 10} reviews)</div>
                
                <div style="display: flex; margin: 1.5rem 0; gap: 2rem; flex-wrap: wrap;">
                    <div style="flex: 1; min-width: 300px;">
                        <img src="${bike.image}" alt="${bike.manufacturer} ${bike.name}" style="max-width: 100%; border: 1px solid #ddd; padding: 1rem;">
                    </div>
                    <div style="flex: 1; min-width: 300px;">
                        <h3 class="section-title">Specifications</h3>
                        <table style="width: 100%; border-collapse: collapse;">
                            <tr>
                                <td style="padding: 0.5rem; border-bottom: 1px solid #eee; font-weight: 600;">Brand</td>
                                <td style="padding: 0.5rem; border-bottom: 1px solid #eee;">${bike.manufacturer}</td>
                            </tr>
                            <tr>
                                <td style="padding: 0.5rem; border-bottom: 1px solid #eee; font-weight: 600;">Model</td>
                                <td style="padding: 0.5rem; border-bottom: 1px solid #eee;">${bike.name}</td>
                            </tr>
                            <tr>
                                <td style="padding: 0.5rem; border-bottom: 1px solid #eee; font-weight: 600;">Year</td>
                                <td style="padding: 0.5rem; border-bottom: 1px solid #eee;">${bike.year}</td>
                            </tr>
                            <tr>
                                <td style="padding: 0.5rem; border-bottom: 1px solid #eee; font-weight: 600;">Type</td>
                                <td style="padding: 0.5rem; border-bottom: 1px solid #eee;">${bike.type.charAt(0).toUpperCase() + bike.type.slice(1)}</td>
                            </tr>
                            <tr>
                                <td style="padding: 0.5rem; border-bottom: 1px solid #eee; font-weight: 600;">Gender</td>
                                <td style="padding: 0.5rem; border-bottom: 1px solid #eee;">${bike.gender.charAt(0).toUpperCase() + bike.gender.slice(1)}</td>
                            </tr>
                            <tr>
                                <td style="padding: 0.5rem; border-bottom: 1px solid #eee; font-weight: 600;">Weight</td>
                                <td style="padding: 0.5rem; border-bottom: 1px solid #eee;">${bike.specs.weight}</td>
                            </tr>
                            <tr>
                                <td style="padding: 0.5rem; border-bottom: 1px solid #eee; font-weight: 600;">Frame Material</td>
                                <td style="padding: 0.5rem; border-bottom: 1px solid #eee;">${bike.specs.material}</td>
                            </tr>
                            <tr>
                                <td style="padding: 0.5rem; border-bottom: 1px solid #eee; font-weight: 600;">Gears</td>
                                <td style="padding: 0.5rem; border-bottom: 1px solid #eee;">${bike.specs.gears}</td>
                            </tr>
                            <tr>
                                <td style="padding: 0.5rem; border-bottom: 1px solid #eee; font-weight: 600;">Shipping</td>
                                <td style="padding: 0.5rem; border-bottom: 1px solid #eee;">${bike.freeShipping ? 'Free' : '$49.99'}</td>
                            </tr>
                        </table>
                        
                        <button class="btn" style="margin-top: 1.5rem; width: 100%;">Add to Cart</button>
                    </div>
                </div>
                
                <h3 class="section-title">Similar Bikes</h3>
                <div class="similar-bikes">
                    ${getSimilarBikes(bike)}
                </div>
            `;
            
            bikeModal.style.display = 'block';
        }
        
        // Get similar bikes HTML
        function getSimilarBikes(currentBike) {
            // Filter bikes of same type but different models
            const similar = recommendedBikes
                .filter(bike => bike.type === currentBike.type && bike.id !== currentBike.id)
                .slice(0, 5);
                
            if (similar.length === 0) {
                return '<p>No similar bikes found.</p>';
            }
            
            return similar.map(bike => `
                <div class="similar-bike-card" data-bike-id="${bike.id}">
                    <div style="height: 120px; display: flex; align-items: center; justify-content: center; padding: 0.5rem; border-bottom: 1px solid #eee;">
                        <img src="${bike.image}" alt="${bike.name}" style="max-height: 100px; max-width: 100%;">
                    </div>
                    <div style="padding: 0.5rem;">
                        <div style="font-size: 0.8rem; color: #666;">${bike.year}</div>
                        <div style="font-weight: 600; font-size: 0.9rem;">${bike.name}</div>
                        <div style="font-size: 0.8rem;">${bike.manufacturer}</div>
                        <div style="color: var(--danger); font-weight: 600; margin-top: 0.3rem;">$${bike.price.toLocaleString()}</div>
                    </div>
                </div>
            `).join('');
        }
        
        // Sort bikes based on selected sort option
        function sortBikes() {
            const sortBy = sortBySelect.value;
            
            switch (sortBy) {
                case 'match':
                    recommendedBikes.sort((a, b) => b.matchScore - a.matchScore);
                    break;
                case 'price-low':
                    recommendedBikes.sort((a, b) => a.price - b.price);
                    break;
                case 'price-high':
                    recommendedBikes.sort((a, b) => b.price - a.price);
                    break;
                case 'year':
                    recommendedBikes.sort((a, b) => b.year - a.year);
                    break;
                default:
                    recommendedBikes.sort((a, b) => b.matchScore - a.matchScore);
            }
            
            // Re-display bikes with new sort order
            if (bikeList.innerHTML !== '') {
                displayBikes();
            }
        }
    </script>
</body>
</html>
